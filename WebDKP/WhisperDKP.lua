local a=nil;function WebDKP_Register_WhisperHook(b)if b and ChatFrame_OnEvent~=WebDKP_ChatFrame_OnEvent_Hook then a=ChatFrame_OnEvent;ChatFrame_OnEvent=WebDKP_ChatFrame_OnEvent_Hook elseif not b and a~=nil then ChatFrame_OnEvent=a end end;function WebDKP_WhisperDKP_Event(c,d,e)local f=WebDKP_GetTableid()local g=d;local h=c;if WebDKP_IsWebDKPWhisper(g,h)then if string.find(string.lower(h),WebDKP.translations.triggerWhisperDKP)==1 then local i=WebDKP_GetMain(g,true)if WebDKP_DkpTable[i]==nil then WebDKP_SendWhisper(g,WebDKP.translations.WhisperDKP1)WebDKP_SendWhisper(g,WebDKP.translations.WhisperDKP2)else local j=WebDKP_GetDKP(i,f)local k=floor((j-1)/WebDKP_TierInterval)if j==0 then k=0 end;WebDKP_SendWhisper(g,WebDKP.translations.WhisperDKP3 ..j)WebDKP_SendWhisper(g,WebDKP.translations.WhisperDKP2)end elseif string.find(string.lower(h),WebDKP.translations.triggerWhisperDKP1)==1 then local l=WebDKP_GetWhisperFiltersFromMessage(h)WebDKP_WhisperSortedList(g,true,l)elseif h==WebDKP.translations.triggerWhisperDKP2 then WebDKP_Standby_GUIToggle("add",g,e)elseif h==WebDKP.translations.triggerWhisperDKP3 then WebDKP_Standby_GUIToggle("remove",g)elseif h==WebDKP.translations.triggerWhisperDKP4 then if WebDKP_CharRaidInfo[g]~=nil then local m=WebDKP_CharRaidInfo[g]["total_raids"]local n=WebDKP_CharRaidInfo[g]["raids_attended"]local o=WebDKP_CharRaidInfo[g]["percent"]WebDKP_SendWhisper(g,WebDKP.translations.WhisperDKP4 ..n..WebDKP.translations.WhisperDKP5 ..m..WebDKP.translations.WhisperDKP6 ..o.." %")else WebDKP_SendWhisper(g,WebDKP.translations.WhisperDKP7)end end end end;function WebDKP_ChatFrame_OnEvent_Hook(self,p,c,d,q,r,s,t,u,v,w,x,y,z,A)if p=="CHAT_MSG_WHISPER"then if WebDKP_IsWebDKPWhisper(d,c)then return end end;if p=="CHAT_MSG_WHISPER_INFORM"then if string.find(c,"^WebDKP: ")or string.find(c,"!Sending")then return end end;if p=="CHAT_MSG_WHISPER_INFORM"then if string.find(c,"^WebDKP: ")or string.find(c,"!SendingAuto")then return end end;a(self,p,c,d,q,r,s,t,u,v,w,x,y,z,A)end;function WebDKP_IsWebDKPWhisper(g,h)if string.find(string.lower(h),"WebDKP:")then return false end;if string.find(string.lower(h),WebDKP.translations.triggerWhisperDKP)==1 or string.find(string.lower(h),WebDKP.translations.triggerWhisperDKP4)==1 or string.find(string.lower(h),WebDKP.translations.triggerWhisperDKP1)==1 or string.find(string.lower(h),WebDKP.translations.triggerWhisperDKP2)==1 or string.find(string.lower(h),WebDKP.translations.triggerWhisperDKP3)==1 or string.find(h,"!Sending")==1 or string.find(h,"!SendingAuto")==1 then return true end;return false end;function WebDKP_WhisperSortedList(B,C,D)local f=WebDKP_GetTableid()if D==nil then D={}end;local E={}for F,G in pairs(WebDKP_DkpTable)do if type(G)=="table"then local H=F;local I=G["class"]local J=WebDKP_GetDKP(H,f)if J~=nil then local K=floor((J-1)/WebDKP_TierInterval)if J==0 then K=0 end;if WebDKP_PassesWhisperFilter(H,I,J,K,C,D)then tinsert(E,{playerName=H,playerClass=I,playerDkp=J,playerTier=K})end end end end;table.sort(E,function(L,M)if L and M then if L.playerDkp==M.playerDkp then return L.playerName>=M.playerName else return L.playerDkp<=M.playerDkp end end end)for F,G in pairs(E)do if G.playerName~=nil and G.playerClass~=nil and G.playerDkp~=nil then WebDKP_SendWhisper(B,G.playerDkp.." : "..G.playerName.." ( "..G.playerClass.." ) ")end end end;function WebDKP_PassesWhisperFilter(g,N,j,k,C,l)N=WebDKP.translations.CLASS_LOCALIZED_TO_ENG_MAP[N]if C then if not WebDKP_PlayerInGroup(g)then return false end end;if l["showall"]then return true else if N==nil then return false end;return not(l[string.lower(N)]==nil)end end;function WebDKP_GetWhisperFiltersFromMessage(O)local l={}l["druid"]=string.find(string.lower(O),"druid")l["hunter"]=string.find(string.lower(O),"hunter")l["mage"]=string.find(string.lower(O),"mage")l["rogue"]=string.find(string.lower(O),"rogue")l["shaman"]=string.find(string.lower(O),"shaman")l["paladin"]=string.find(string.lower(O),"paladin")l["priest"]=string.find(string.lower(O),"priest")l["warrior"]=string.find(string.lower(O),"warrior")l["warlock"]=string.find(string.lower(O),"warlock")if WebDKP_GetTableSize(l)==0 then local P;for F,G in pairs(WebDKP.translations.CLASS_ALIAS_TO_ENG_MAP)do P=string.find(string.upper(O)," "..F)if P~=nil then l[G]=P end end end;if WebDKP_GetTableSize(l)==0 then local Q;for F,G in pairs(WebDKP.translations.CLASS_LOCALIZED_TO_ENG_MAP)do Q=string.find(string.upper(O)," "..F)if Q~=nil then l[string.lower(G)]=Q end end end;if l["druid"]==nil and l["hunter"]==nil and l["mage"]==nil and l["rogue"]==nil and l["shaman"]==nil and l["paladin"]==nil and l["priest"]==nil and l["warrior"]==nil and l["warlock"]==nil then l["showall"]=true else l["showall"]=false end;return l end