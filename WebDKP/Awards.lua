function WebDKP_AwardItem_Event()local a=false;for _,b in pairs(WebDKP_WebOptions)do a=SG~=nil and SG==b or next(WebDKP_Tables)==nil;if a then break end end;if not a then return end;local name,class,guild;local c=WebDKP_AwardItem_FrameItemCost:GetText()if c==nil or c==""then WebDKP_Print(WebDKP.translations.Noinput_Print)c="0"end;local d=string.find(c,"%%")local e=0;local f=WebDKP_GetTableid()local g=WebDKP_AwardItem_FrameItemName:GetText()if g==nil or g==""then WebDKP_Print(WebDKP.translations.ItemName_Print)PlaySound(847)return end;if d~=nil then c=string.gsub(c,"%%","")c=tonumber(c)e=1 end;c=math.abs(tonumber(c))c=WebDKP_ROUND(c,2)local points=c*-1;local h=WebDKP_GetSelectedPlayers(1)if h==nil or h==""then WebDKP_Print(WebDKP.translations.Noplayer_Print)PlaySound(847)else if e==1 then local i=h[0]["name"]c=c/100*WebDKP_DkpTable[i]["dkp_"..f]*-1;points=WebDKP_ROUND(c,2)end;WebDKP_AddDKP(points,g,"true",h)WebDKP_UpdateTableToShow()WebDKP_UpdateTable()WebDKP_AnnounceAwardItem(points,g,h[0]["name"])end;WebDKP_UnselectAll()end;function WebDKP_AwardDKP_Event()local a=false;for _,b in pairs(WebDKP_WebOptions)do a=SG~=nil and SG==b or next(WebDKP_Tables)==nil;if a then break end end;if not a then return end;local name,class,guild;local points=WebDKP_AwardDKP_FramePoints:GetText()local j=WebDKP_AwardDKP_FrameReason:GetText()if j==""or j==nil then j=WebDKP.translations.Noreasonspecified end;points=tonumber(points)if points==nil or points==""then WebDKP_Print(WebDKP.translations.RewardPoints_Print)PlaySound(847)return end;points=WebDKP_ROUND(points,2)local k=WebDKP_GetSelectedPlayers(0)if k==nil then WebDKP_Print(WebDKP.translations.Nochoice_Print)PlaySound(847)else WebDKP_AddDKP(points,j,"false",k)WebDKP_UpdateTableToShow()WebDKP_UpdateTable()WebDKP_AnnounceAward(points,j)end;WebDKP_UnselectAll()end;function WebDKP_AddDKP(points,j,forItem,k)local date=date("%Y-%m-%d %H:%M:%S")local l=GetZoneText()local f=WebDKP_GetTableid()local m=UnitName("player")local n=points;if WebDKP_Options["EnableSynch"]==1 then WebDKP_Synch_Auto(points,forItem,k,j,date)end;if not WebDKP_Log then WebDKP_Log={}end;local _,o,p=WebDKP_GetItemInfo(j)local q=WebDKP_GetItemID(p)WebDKP_Log["Version"]=2;if forItem=="true"then j=o;if not WebDKP_Log[j.." "..date]then WebDKP_Log[j.." "..date]={}end;WebDKP_Log[j.." "..date]["itemlink"]=p;WebDKP_Log[j.." "..date]["reason"]=j;WebDKP_Log[j.." "..date]["itemid"]=q else if not WebDKP_Log[j.." "..date]then WebDKP_Log[j.." "..date]={}end;WebDKP_Log[j.." "..date]["itemlink"]=j;WebDKP_Log[j.." "..date]["reason"]=j end;WebDKP_Log[j.." "..date]["date"]=date;WebDKP_Log[j.." "..date]["foritem"]=forItem;WebDKP_Log[j.." "..date]["zone"]=l;WebDKP_Log[j.." "..date]["tableid"]=f;WebDKP_Log[j.." "..date]["awardedby"]=m;WebDKP_Log[j.." "..date]["points"]=points;if q==nil and forItem=="true"then WebDKP_Log[j.." "..date]["itemid"]="0"end;if not WebDKP_Log[j.." "..date]["awarded"]then WebDKP_Log[j.." "..date]["awarded"]={}end;for r,b in pairs(k)do if type(b)=="table"then name=b["name"]class=b["class"]guild=WebDKP_GetGuildName(name)points=n;if WebDKP_Alts[name]~=nil then name=WebDKP_Alts[name]end;local s=tonumber(WebDKP_Options["dkpCapLimit"])if WebDKP_Options["dkpCap"]==1 and WebDKP_DkpTable[name]["dkp_"..f]+points>s then points=s-WebDKP_DkpTable[name]["dkp_"..f]if not WebDKP_Log[j.." CAP"..points.." "..date]then WebDKP_Log[j.." CAP"..points.." "..date]={}WebDKP_Log[j.." CAP"..points.." "..date]["itemlink"]=p;WebDKP_Log[j.." CAP"..points.." "..date]["reason"]=j.." CAP"..points;WebDKP_Log[j.." CAP"..points.." "..date]["date"]=date;WebDKP_Log[j.." CAP"..points.." "..date]["foritem"]=forItem;WebDKP_Log[j.." CAP"..points.." "..date]["zone"]=l;WebDKP_Log[j.." CAP"..points.." "..date]["tableid"]=f;WebDKP_Log[j.." CAP"..points.." "..date]["awardedby"]=m;WebDKP_Log[j.." CAP"..points.." "..date]["points"]=points;WebDKP_Log[j.." CAP"..points.." "..date]["awarded"]={}end;WebDKP_Log[j.." CAP"..points.." "..date]["awarded"][name]={}WebDKP_Log[j.." CAP"..points.." "..date]["awarded"][name]["name"]=name;WebDKP_Log[j.." CAP"..points.." "..date]["awarded"][name]["guild"]=guild;WebDKP_Log[j.." CAP"..points.." "..date]["awarded"][name]["class"]=class;WebDKP_AddDKPToTable(name,class,points)else WebDKP_AddDKPToTable(name,class,points)WebDKP_Log[j.." "..date]["awarded"][name]={}WebDKP_Log[j.." "..date]["awarded"][name]["name"]=name;WebDKP_Log[j.." "..date]["awarded"][name]["guild"]=guild;WebDKP_Log[j.." "..date]["awarded"][name]["class"]=class;if forItem=="true"then break end end end end;if WebDKP_WebOptions["ZeroSumEnabled"]==1 and forItem=="true"then WebDKP_AwardZeroSum(points,j,date)end;WebDKP_UpdateLogTable()end;function WebDKP_AddDKPToTable(name,class,points,t)local f=WebDKP_GetTableid()if WebDKP_WebOptions["CombineAlts"]==1 then name=WebDKP_GetMain(name)end;local f=WebDKP_GetTableid()if t~=nil then f=t end;WebDKP_MakeSureInTable(name,f,class,0)if WebDKP_Options["dkpCap"]==1 then local s=tonumber(WebDKP_Options["dkpCapLimit"])if WebDKP_DkpTable[name]["dkp_"..f]+points>s then points=s-WebDKP_DkpTable[name]["dkp_"..f]end end;WebDKP_DkpTable[name]["dkp_"..f]=WebDKP_DkpTable[name]["dkp_"..f]+points;WebDKP_DkpTable[name]["cantrim"]=false end;function WebDKP_AwardZeroSum(points,j,date)WebDKP_UpdatePlayersInGroup()local u=WebDKP_PlayersInGroup;local v=WebDKP_GetTableSize(WebDKP_PlayersInGroup)if WebDKP_Options["ZeroSumStandby"]==1 then for r,b in pairs(WebDKP_DkpTable)do if type(b)=="table"then local w=r;local x=b["class"]local y=b["standby"]if y~=nil and y==1 then v=v+1;u[v]={["name"]=w,["class"]=x}end end end end;local z=points*-1/v;z=WebDKP_ROUND(z,2)j=WebDKP.translations.reasonZerosum..j;WebDKP_AddDKP(z,j,"false",u)end;function WebDKP_GetSelectedPlayers(A)local B={}local C=0;for D,b in pairs(WebDKP_DkpTable)do if type(b)=="table"then if b["Selected"]then B[C]={["name"]=D,["class"]=b["class"]}C=C+1;if A~=0 and C>=A then return B end end end end;if C==0 then return nil else return B end end;function WebDKP_Decay()local name,class,guild;local k=WebDKP_GetSelectedPlayers(0)local date=date("%Y-%m-%d %H:%M:%S")local l=GetZoneText()local f=WebDKP_GetTableid()local m=UnitName("player")local E=0;local F=tonumber(WebDKP_Options["Decay"])if F~=nil and F~=""then if WebDKP_Options["EnableSynch"]==1 then WebDKP_Synch_Auto(F,"false",k,"Decay",date)end;if not WebDKP_Log then WebDKP_Log={}end;if k==nil then WebDKP_Print(WebDKP.translations.Nochoice_Print)PlaySound(847)else for r,b in pairs(k)do if type(b)=="table"then name=b["name"]class=b["class"]dkp=WebDKP_GetDKP(name)if dkp>=2 and F>0 then points=WebDKP_ROUND(dkp*F,0)*-1 elseif dkp<2 and F<0 then points=WebDKP_ROUND(dkp*F,0)else points=0 end;guild=WebDKP_GetGuildName(name)WebDKP_AddDKPToTable(name,class,points)local j=WebDKP.translations.reasondecay..E;if not WebDKP_Log[j.." "..date]then WebDKP_Log[j.." "..date]={}end;WebDKP_Log["Version"]=2;WebDKP_Log[j.." "..date]["itemlink"]="Decay Award"WebDKP_Log[j.." "..date]["reason"]=j;WebDKP_Log[j.." "..date]["date"]=date;WebDKP_Log[j.." "..date]["foritem"]="false"WebDKP_Log[j.." "..date]["zone"]=l;WebDKP_Log[j.." "..date]["tableid"]=f;WebDKP_Log[j.." "..date]["awardedby"]=m;WebDKP_Log[j.." "..date]["points"]=points;if not WebDKP_Log[j.." "..date]["awarded"]then WebDKP_Log[j.." "..date]["awarded"]={}end;WebDKP_Log[j.." "..date]["awarded"][name]={}WebDKP_Log[j.." "..date]["awarded"][name]["name"]=name;WebDKP_Log[j.." "..date]["awarded"][name]["guild"]=guild;WebDKP_Log[j.." "..date]["awarded"][name]["class"]=class;E=E+1 end end;WebDKP_Print(WebDKP.translations.hasapplieddecay)WebDKP_UpdateTableToShow()WebDKP_UpdateTable()WebDKP_UpdateLogTable()end end end;function WebDKP_AddLogDKP(points,k)local f=WebDKP_GetTableid()for r,b in pairs(k)do if type(b)=="table"then name=b["name"]WebDKP_AddDKPToTable(name,_,points)if forItem=="true"then break end end end;WebDKP_UpdateDKPTable()end