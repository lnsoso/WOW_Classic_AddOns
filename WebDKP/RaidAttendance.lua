global_raid=""global_startTime=""previous_raid=""previous_starttime=""previous_name=""function WebDKP_RaidLog_ToggleUI()if WebDKP_RaidInfoFrame:IsShown()then WebDKP_RaidInfoFrame:Hide()else WebDKP_RaidInfoFrame:Show()WebDKP_UpdateRaidLogTable()end end;function WebDKP_CharRaidLog_ToggleUI()if WebDKP_CharRaidInfoFrame:IsShown()then WebDKP_CharRaidInfoFrame:Hide()else WebDKP_CharRaidInfoFrame:Show()WebDKP_UpdateCharRaidLogTable()end end;function WebDKP_HandleMouseOverRaidLog(self)local a=self;if WebDKP_RaidInfo~=nil then local b=_G[a:GetName().."RaidLocation"]:GetText()local c=_G[a:GetName().."date"]:GetText()local d=_G[a:GetName().."startTime"]:GetText()local e=strjoin(" ",c,d)if not WebDKP_RaidInfo[b.." "..e]["selected"]then _G[a:GetName().."Background"]:SetVertexColor(0.2,0.2,0.7,0.5)end end end;function WebDKP_HandleMouseOverCharRaidLog(self)local a=self;if WebDKP_CharRaidInfo~=nil then local charname=_G[a:GetName().."CharName"]:GetText()local f=_G[a:GetName().."CharRaidTot"]:GetText()local g=_G[a:GetName().."CharRaidAttended"]:GetText()local h=_G[a:GetName().."CharRaidPercent"]:GetText()if not WebDKP_CharRaidInfo[charname]["selected"]then _G[a:GetName().."Background"]:SetVertexColor(0.2,0.2,0.7,0.5)end end end;function WebDKP_HandleMouseLeaveRaidLog(self)local a=self;if WebDKP_RaidInfo~=nil then local b=_G[a:GetName().."RaidLocation"]:GetText()local c=_G[a:GetName().."date"]:GetText()local d=_G[a:GetName().."startTime"]:GetText()local e=strjoin(" ",c,d)if not WebDKP_RaidInfo[b.." "..e]["selected"]then _G[a:GetName().."Background"]:SetVertexColor(0,0,0,0)end end end;function WebDKP_HandleMouseLeaveCharRaidLog(self)local a=self;if WebDKP_CharRaidInfo~=nil then local charname=_G[a:GetName().."CharName"]:GetText()local f=_G[a:GetName().."CharRaidTot"]:GetText()local g=_G[a:GetName().."CharRaidAttended"]:GetText()local h=_G[a:GetName().."CharRaidPercent"]:GetText()if not WebDKP_CharRaidInfo[charname]["selected"]then _G[a:GetName().."Background"]:SetVertexColor(0,0,0,0)end end end;function WebDKP_SelectRaidLogToggle(self)local a=self;if WebDKP_RaidInfo~=nil then if previous_raid~=""and previous_starttime~=""then WebDKP_RaidInfo[previous_raid.." "..previous_starttime]["selected"]=false end;if _G["LineLocation"]~=""then _G["LineLocation"]:SetVertexColor(0,0,0,0)end;local b=_G[a:GetName().."RaidLocation"]:GetText()local c=_G[a:GetName().."date"]:GetText()local d=_G[a:GetName().."startTime"]:GetText()local e=strjoin(" ",c,d)if WebDKP_RaidInfo[b.." "..e]["selected"]then WebDKP_RaidInfo[b.." "..e]["selected"]=false;_G[a:GetName().."Background"]:SetVertexColor(0.2,0.2,0.7,0.5)else WebDKP_RaidInfo[b.." "..e]["selected"]=true;_G[a:GetName().."Background"]:SetVertexColor(0.1,0.1,0.9,0.8)end;previous_raid=b;previous_starttime=e;_G["LineLocation"]=_G[a:GetName().."Background"]WebDKP_UpdateAttendedTable(b,e)end end;function WebDKP_SelectCharRaidLogToggle(self)local a=self;if WebDKP_CharRaidInfo~=nil then if previous_name~=nil and previous_name~=""then WebDKP_CharRaidInfo[previous_name]["selected"]=false end;if _G["LineLocation"]~=""then _G["LineLocation"]:SetVertexColor(0,0,0,0)end;local charname=_G[a:GetName().."CharName"]:GetText()if WebDKP_CharRaidInfo[charname]["selected"]then WebDKP_CharRaidInfo[charname]["selected"]=false;_G[a:GetName().."Background"]:SetVertexColor(0.2,0.2,0.7,0.5)else WebDKP_CharRaidInfo[charname]["selected"]=true;_G[a:GetName().."Background"]:SetVertexColor(0.1,0.1,0.9,0.8)end;previous_name=charname;_G["LineLocation"]=_G[a:GetName().."Background"]WebDKP_UpdateCharAttendedTable(charname)end end;function WebDKP_SelectAttendeeLogToggle(self)local a=self;if WebDKP_RaidInfo~=nil then if _G["LineLocation"]~=""then _G["LineLocation"]:SetVertexColor(0,0,0,0)end;local i=_G[a:GetName().."Attended"]:GetText()if i~=nil then WebDKP_RaidInfoFrameCharChange:SetText(i)end end end;function WebDKP_UpdateRaidLogTable()if WebDKP_RaidInfo~=nil then local j={}local i={}for k,l in pairs(WebDKP_RaidInfo)do countnames=0;if type(l)=="table"then if l["raid"]~=nil and l["date"]~=nil and l["starttime"]~=nil and l["endtime"]~=nil and l["totaltime"]~=nil and l["completedate"]~=nil then tinsert(j,{l["raid"],l["date"],l["starttime"],l["endtime"],l["totaltime"],l["completedate"]})end end end;table.sort(j,function(m,n)if m and n then if m==nil then return 1>0 elseif n==nil then return 1<0 end;if WebDKP_LogSort["way4"]==1 then if m[WebDKP_LogSort["curr4"]]==n[WebDKP_LogSort["curr4"]]then return m[1]>n[1]else return m[WebDKP_LogSort["curr4"]]>n[WebDKP_LogSort["curr4"]]end else if m[WebDKP_LogSort["curr4"]]==n[WebDKP_LogSort["curr4"]]then return m[1]<n[1]else return m[WebDKP_LogSort["curr4"]]<n[WebDKP_LogSort["curr4"]]end end end end)local o=getn(j)local p=FauxScrollFrame_GetOffset(WebDKP_RaidInfoFrameScrollRaidLogFrame)FauxScrollFrame_Update(WebDKP_RaidInfoFrameScrollRaidLogFrame,o,20,20)for q=1,20,1 do local r=getglobal("WebDKP_RaidInfoFrameLine"..q)raidText=getglobal("WebDKP_RaidInfoFrameLine"..q.."RaidLocation")dateText=getglobal("WebDKP_RaidInfoFrameLine"..q.."date")local s=getglobal("WebDKP_RaidInfoFrameLine"..q.."startTime")local t=getglobal("WebDKP_RaidInfoFrameLine"..q.."endTime")local u=getglobal("WebDKP_RaidInfoFrameLine"..q.."totaltime")local v=q+FauxScrollFrame_GetOffset(WebDKP_RaidInfoFrameScrollRaidLogFrame)if v<=o then r:Show()raidText:SetText(j[v][1])dateText:SetText(j[v][2])s:SetText(j[v][3])t:SetText(j[v][4])u:SetText(j[v][5])else r:Hide()end end end end;function WebDKP_UpdateCharRaidLogTable()WebDKP_UpdatePlayersInGroup()local w=WebDKP_CharRaidInfoFrameFilterDate:GetText()local x=WebDKP_CharRaidInfoFrameApplyFilterDate:GetChecked()if WebDKP_CharRaidInfo~=nil then local j={}if WebDKP_Options["InGroup"]==1 then for k,l in pairs(WebDKP_PlayersInGroup)do if type(l)=="table"then if l["name"]~=nil then if WebDKP_CharRaidInfo[l["name"]]~=nil then tinsert(j,{l["name"],WebDKP_CharRaidInfo[l["name"]]["total_raids"],WebDKP_CharRaidInfo[l["name"]]["raids_attended"],WebDKP_CharRaidInfo[l["name"]]["percent"]})end end end end else local i={}for k,l in pairs(WebDKP_CharRaidInfo)do countnames=0;if type(l)=="table"then if l["total_raids"]~=nil and l["raids_attended"]~=nil and l["percent"]~=nil then tinsert(j,{k,l["total_raids"],l["raids_attended"],l["percent"]})end end end end;table.sort(j,function(m,n)if m and n then if m==nil then return 1>0 elseif n==nil then return 1<0 end;if WebDKP_LogSort["way4"]==1 then if m[WebDKP_LogSort["curr4"]]==n[WebDKP_LogSort["curr4"]]then return m[1]>n[1]else return m[WebDKP_LogSort["curr4"]]>n[WebDKP_LogSort["curr4"]]end else if m[WebDKP_LogSort["curr4"]]==n[WebDKP_LogSort["curr4"]]then return m[1]<n[1]else return m[WebDKP_LogSort["curr4"]]<n[WebDKP_LogSort["curr4"]]end end end end)local o=getn(j)local p=FauxScrollFrame_GetOffset(WebDKP_CharRaidInfoFrameScrollCharRaidLogFrame)FauxScrollFrame_Update(WebDKP_CharRaidInfoFrameScrollCharRaidLogFrame,o,25,20)if x then local month,day,year=WebDKP_ApplyDateFilter(w)end;for q=1,23,1 do local r=getglobal("WebDKP_CharRaidInfoFrameLine"..q)nameText=getglobal("WebDKP_CharRaidInfoFrameLine"..q.."CharName")local y=getglobal("WebDKP_CharRaidInfoFrameLine"..q.."CharRaidTot")local z=getglobal("WebDKP_CharRaidInfoFrameLine"..q.."CharRaidAttended")local A=getglobal("WebDKP_CharRaidInfoFrameLine"..q.."CharRaidPercent")local v=q+FauxScrollFrame_GetOffset(WebDKP_CharRaidInfoFrameScrollCharRaidLogFrame)if v<=o then r:Show()local charname=j[v][1]local B=j[v][2]local C=j[v][3]local D=j[v][4]if x and month~=nil then B,C,D=WebDKP_ProcessCharAttendedRaids(month,day,year,charname)end;nameText:SetText(charname)if WebDKP_DkpTable[charname]~=nil and WebDKP_DkpTable[charname]["class"]~=nil then local E=WebDKP_DkpTable[charname]["class"]E=string.upper(E)E=string.gsub(E," ","")local F=WebDKP.translations.CLASS_LOCALIZED_TO_ENG_MAP[E]if F~=nil then local G,H,I,J=GetClassColor(string.upper(F))nameText:SetTextColor(G,H,I)end end;y:SetText(B)z:SetText(C)A:SetText(D)else r:Hide()end end end end;function WebDKP_UpdateCharAttendedTable(name)local w=WebDKP_CharRaidInfoFrameFilterDate:GetText()local x=WebDKP_CharRaidInfoFrameApplyFilterDate:GetChecked()raidsattended=WebDKP_CharRaidInfo[name]["attended"]local j={}local K=getn(raidsattended)for q=1,K,1 do stringdata=raidsattended[q]attendedholder,raidlocation1,raiddate1=strsplit("&",stringdata)if attendedholder=="1"then if x then local L=WebDKP_CrossCheckDate(raiddate1)if L==true then tinsert(j,{raidlocation1,raiddate1})end else tinsert(j,{raidlocation1,raiddate1})end end end;table.sort(j,function(m,n)if m and n then if m==nil then return 1>0 elseif n==nil then return 1<0 end;if WebDKP_LogSort["way4"]==1 then if m[WebDKP_LogSort["curr4"]]==n[WebDKP_LogSort["curr4"]]then return m[1]>n[1]else return m[WebDKP_LogSort["curr4"]]>n[WebDKP_LogSort["curr4"]]end else if m[WebDKP_LogSort["curr4"]]==n[WebDKP_LogSort["curr4"]]then return m[1]<n[1]else return m[WebDKP_LogSort["curr4"]]<n[WebDKP_LogSort["curr4"]]end end end end)local o=getn(j)local p=FauxScrollFrame_GetOffset(WebDKP_CharRaidInfoFrameScrollAttendedRaidFrame)FauxScrollFrame_Update(WebDKP_CharRaidInfoFrameScrollAttendedRaidFrame,o,25,20)for q=1,23,1 do local r=getglobal("WebDKP_CharRaidInfoFrameLines"..q)locationText=getglobal("WebDKP_CharRaidInfoFrameLines"..q.."RaidLocation")dateText=getglobal("WebDKP_CharRaidInfoFrameLines"..q.."RaidDate")local v=q+FauxScrollFrame_GetOffset(WebDKP_CharRaidInfoFrameScrollAttendedRaidFrame)if v<=o then r:Show()local M=j[v][1]local N=j[v][2]locationText:SetText(M)dateText:SetText(N)else r:Hide()end end end;function WebDKP_UpdateAttendedTable(b,O)nameentries=WebDKP_RaidInfo[b.." "..O]["attended"]table.sort(nameentries,function(P,Q)return P<Q end)local o=getn(nameentries)local p=FauxScrollFrame_GetOffset(WebDKP_RaidInfoFrameScrollAttendeeFrame)FauxScrollFrame_Update(WebDKP_RaidInfoFrameScrollAttendeeFrame,o,25,20)for q=1,25,1 do local r=getglobal("WebDKP_RaidInfoFrameLines"..q)attendedText=getglobal("WebDKP_RaidInfoFrameLines"..q.."Attended")local v=q+FauxScrollFrame_GetOffset(WebDKP_RaidInfoFrameScrollAttendeeFrame)if v<=o then r:Show()local charname=nameentries[v]attendedText:SetText(charname)if WebDKP_DkpTable[charname]~=nil and WebDKP_DkpTable[charname]["class"]~=nil then local E=WebDKP_DkpTable[charname]["class"]E=string.upper(E)E=string.gsub(E," ","")local F=WebDKP.translations.CLASS_LOCALIZED_TO_ENG_MAP[E]if F~=nil then local G,H,I,J=GetClassColor(string.upper(F))attendedText:SetTextColor(G,H,I)end end else r:Hide()end end end;function WebDKP_RaidStart()local R=date("%H:%M:%S")local S=date("%Y-%m-%d %H:%M:%S")local T=date("%Y%m%d%H%M%S")T=tonumber(T)local date=date("%Y-%m-%d")local b=GetZoneText()global_startTime=S;global_raid=b;if not WebDKP_RaidInfo then WebDKP_RaidInfo={}end;if not WebDKP_CharRaidInfo then WebDKP_CharRaidInfo={}end;if not WebDKP_RaidInfo[b.." "..S]then WebDKP_RaidInfo[b.." "..S]={}end;WebDKP_RaidInfo[b.." "..S]["raid"]=b;WebDKP_RaidInfo[b.." "..S]["date"]=date;WebDKP_RaidInfo[b.." "..S]["starttime"]=R;WebDKP_RaidInfo[b.." "..S]["endtime"]=""WebDKP_RaidInfo[b.." "..S]["totaltime"]=""WebDKP_RaidInfo[b.." "..S]["attended"]={}WebDKP_RaidInfo[b.." "..S]["completedate"]=T;if WebDKP_CharRaidInfo~=nil then local U=getn(WebDKP_CharRaidInfo)for k,l in pairs(WebDKP_CharRaidInfo)do charname=k;WebDKP_CharRaidInfo[charname]["total_raids"]=WebDKP_CharRaidInfo[charname]["total_raids"]+1;tinsert(WebDKP_CharRaidInfo[charname]["attended"],"0&"..b.."&"..S)end end;WebDKP_UpdatePlayersInGroup()for k,l in pairs(WebDKP_PlayersInGroup)do name=l["name"]if WebDKP_CharRaidInfo[name]==nil then WebDKP_CharRaidInfo[name]={}WebDKP_CharRaidInfo[name]["total_raids"]=1;WebDKP_CharRaidInfo[name]["raids_attended"]=1;WebDKP_CharRaidInfo[name]["percent"]=100;WebDKP_CharRaidInfo[name]["attended"]={}tinsert(WebDKP_CharRaidInfo[name]["attended"],"1&"..b.."&"..S)else WebDKP_CharRaidInfo[name]["raids_attended"]=WebDKP_CharRaidInfo[name]["raids_attended"]+1;local V=getn(WebDKP_CharRaidInfo[name]["attended"])for q=1,V,1 do if WebDKP_CharRaidInfo[name]["attended"][q]=="0&"..b.."&"..S then WebDKP_CharRaidInfo[name]["attended"][q]="1&"..b.."&"..S end end end;tinsert(WebDKP_RaidInfo[b.." "..S]["attended"],l["name"])end;WebDKP_UpdateRaidLogTable()if WebDKP_CharRaidInfo~=nil then for k,l in pairs(WebDKP_CharRaidInfo)do charname1=k;WebDKP_CharRaidInfo[charname1]["percent"]=WebDKP_ROUND(WebDKP_CharRaidInfo[charname1]["raids_attended"]/WebDKP_CharRaidInfo[charname1]["total_raids"]*100,0)end end end;function WebDKP_RaidEnd()if global_startTime~=""and global_raid~=""then local W=date("%H:%M:%S")local X="(%d%d):(%d%d):(%d%d)"_,_,hoursa,minutesa,secondsa=string.find(W,X)_,_,hoursb,minutesb,secondsb=string.find(global_startTime,X)local Y=hoursa-hoursb;if Y<0 then Y=24+Y end;local Z=60-minutesb+minutesa;if Z>=60 then Z=Z-60 end;if Z<10 then Z=strjoin("","0",Z)end;local e=strjoin(":",Y,Z)totaltimeraid=e;if WebDKP_RaidInfo[global_raid.." "..global_startTime]then WebDKP_RaidInfo[global_raid.." "..global_startTime]["endtime"]=W;WebDKP_RaidInfo[global_raid.." "..global_startTime]["totaltime"]=totaltimeraid end;global_startTime=""gloabl_raid=""WebDKP_UpdateRaidLogTable()end end;function WebDKP_ScrollRaidLogListToggle()WebDKP_UpdateRaidLogTable()if WebDKP_RaidInfo~=nil then if global_startTime~=""and global_raid~=""then WebDKP_RaidInfo[global_raid.." "..global_startTime]["selected"]=false end;if _G["LineLocation"]~=""then _G["LineLocation"]:SetVertexColor(0,0,0,0)end end end;function WebDKP_ScrollLogAttendedToggle()WebDKP_UpdateAttendedTable(previous_raid,previous_starttime)end;function WebDKP_ScrollCharRaidLogListToggle()WebDKP_UpdateCharRaidLogTable()end;function WebDKP_ScrollAttendedRaidToggle()WebDKP_UpdateCharAttendedTable(previous_name)end;function WebDKP_DeleteRaid()if previous_raid~=""and previous_starttime~=""then if WebDKP_RaidInfo[previous_raid.." "..previous_starttime]["attended"]~=nil then if WebDKP_CharRaidInfo~=nil then for k,l in pairs(WebDKP_CharRaidInfo)do charname=k;local U=getn(WebDKP_CharRaidInfo[charname]["attended"])for q=1,U,1 do if WebDKP_CharRaidInfo[charname]["attended"][q]=="1&"..previous_raid.."&"..previous_starttime or WebDKP_CharRaidInfo[charname]["attended"][q]=="0&"..previous_raid.."&"..previous_starttime then WebDKP_CharRaidInfo[charname]["total_raids"]=WebDKP_CharRaidInfo[charname]["total_raids"]-1 end end;WebDKP_CharRaidInfo[charname]["percent"]=WebDKP_ROUND(WebDKP_CharRaidInfo[charname]["raids_attended"]/WebDKP_CharRaidInfo[charname]["total_raids"]*100,0)end end;getcharentries=getn(WebDKP_RaidInfo[previous_raid.." "..previous_starttime]["attended"])for q=1,getcharentries,1 do charsname=WebDKP_RaidInfo[previous_raid.." "..previous_starttime]["attended"][q]if WebDKP_CharRaidInfo[charsname]~=nil then getentriesrem=getn(WebDKP_CharRaidInfo[charsname]["attended"])for q=1,getentriesrem,1 do if WebDKP_CharRaidInfo[charsname]["attended"][q]=="1&"..previous_raid.."&"..previous_starttime then WebDKP_CharRaidInfo[charsname]["attended"][q]="0&"..previous_raid.."&"..previous_starttime end end;WebDKP_CharRaidInfo[charsname]["raids_attended"]=WebDKP_CharRaidInfo[charsname]["raids_attended"]-1 end;WebDKP_CharRaidInfo[charsname]["percent"]=WebDKP_ROUND(WebDKP_CharRaidInfo[charsname]["raids_attended"]/WebDKP_CharRaidInfo[charsname]["total_raids"]*100,0)end;WebDKP_RaidInfo[previous_raid.." "..previous_starttime]=nil;_G["LineLocation"]:SetVertexColor(0,0,0,0)_G["LineLocation"]=""previous_raid=""previous_starttime=""WebDKP_UpdateRaidLogTable()end;for q=1,25,1 do local r=getglobal("WebDKP_RaidInfoFrameLines"..q)r:Hide()end end end;function WebDKP_EndTime()local a0=WebDKP_RaidInfoFrameEndTime:GetText()if a0~=nil and a0~=""then local a1=tonumber(a0)if a1>0 then if previous_raid~=""and previous_starttime~=""then if WebDKP_RaidInfo[previous_raid.." "..previous_starttime]["attended"]~=nil then local X="(%d%d):(%d%d):(%d%d)"local a2="(%d+).(%d+)"local a3,a4=string.find(a0,"%.")if a3==1 then a0=strjoin("","0",a0)end;if a3==nil then a0=strjoin(".",a0,"0")end;_,_,hours,minutes=string.find(a0,a2)minutes=strjoin("",".",minutes)minutes=tonumber(minutes)minutes=60*minutes;_,_,hoursb,minutesb,secondsb=string.find(previous_starttime,X)hoursb=hoursb+hours;minutesb=minutesb+minutes;if minutesb>59 then hoursb=hoursb+1;minutesb=minutesb-60 end;if minutesb<10 then minutesb=strjoin("","0",minutesb)end;local a5="00"if minutes<10 then minutes=strjoin("","0",minutes)end;local e=strjoin(":",hours,minutes)totaltimeraid=e;local a6=strjoin(":",hoursb,minutesb,a5)endraid=a6;WebDKP_RaidInfo[previous_raid.." "..previous_starttime]["totaltime"]=totaltimeraid;WebDKP_RaidInfo[previous_raid.." "..previous_starttime]["endtime"]=endraid;_G["LineLocation"]:SetVertexColor(0,0,0,0)_G["LineLocation"]=""previous_raid=""previous_starttime=""WebDKP_UpdateRaidLogTable()end end end end end;function WebDKP_DeleteAttendee()local a7=WebDKP_RaidInfoFrameCharChange:GetText()if previous_raid~=""and previous_starttime~=""and a7~=nil and a7~=""then name_entries=WebDKP_RaidInfo[previous_raid.." "..previous_starttime]["attended"]local o=getn(name_entries)for q=1,o,1 do if name_entries[q]==a7 then local a8=name_entries[q]local V=getn(WebDKP_CharRaidInfo[a8]["attended"])for q=1,V,1 do if WebDKP_CharRaidInfo[a8]["attended"][q]=="1&"..previous_raid.."&"..previous_starttime then WebDKP_CharRaidInfo[a8]["attended"][q]="0&"..previous_raid.."&"..previous_starttime end end;WebDKP_CharRaidInfo[a8]["raids_attended"]=WebDKP_CharRaidInfo[a8]["raids_attended"]-1;WebDKP_CharRaidInfo[a8]["percent"]=WebDKP_ROUND(WebDKP_CharRaidInfo[a8]["raids_attended"]/WebDKP_CharRaidInfo[a8]["total_raids"]*100,0)table.remove(name_entries,q)end end;WebDKP_RaidInfo[previous_raid.." "..previous_starttime]["attended"]=name_entries;WebDKP_UpdateAttendedTable(previous_raid,previous_starttime)end end;function WebDKP_RemAttendee()WebDKP_CharRaidInfo[previous_name]=nil;WebDKP_UpdateCharRaidLogTable()for q=1,25,1 do local r=getglobal("WebDKP_RaidInfoFrameLines"..q)r:Hide()end;previous_name=""end;function WebDKP_AddAttendee()local a9=WebDKP_RaidInfoFrameCharChange:GetText()local aa=0;local ab=0;if WebDKP_CharRaidInfo[a9]~=nil then local ac=WebDKP_CharRaidInfo[a9]["attended"][1]_,charfirstraiddate=strsplit("&",ac)else charfirstraiddate=0 end;if previous_raid~=""and previous_starttime~=""and a9~=nil and a9~=""then name_entries=WebDKP_RaidInfo[previous_raid.." "..previous_starttime]["attended"]local o=getn(name_entries)for k,l in pairs(name_entries)do charname=l;if charname==a9 then aa=1 end end;if aa==0 then table.insert(name_entries,a9)WebDKP_RaidInfo[previous_raid.." "..previous_starttime]["attended"]=name_entries;if WebDKP_CharRaidInfo[a9]==nil then WebDKP_CharRaidInfo[a9]={}WebDKP_CharRaidInfo[a9]["raids_attended"]=1;WebDKP_CharRaidInfo[a9]["total_raids"]=1;WebDKP_CharRaidInfo[a9]["percent"]=100;WebDKP_CharRaidInfo[a9]["attended"]={}tinsert(WebDKP_CharRaidInfo[a9]["attended"],"1&"..previous_raid.."&"..previous_starttime)else WebDKP_CharRaidInfo[a9]["raids_attended"]=WebDKP_CharRaidInfo[a9]["raids_attended"]+1;local V=getn(WebDKP_CharRaidInfo[a9]["attended"])for q=1,V,1 do if WebDKP_CharRaidInfo[a9]["attended"][q]=="0&"..previous_raid.."&"..previous_starttime then WebDKP_CharRaidInfo[a9]["attended"][q]="1&"..previous_raid.."&"..previous_starttime;ab=1 end end;if ab==0 then WebDKP_CharRaidInfo[a9]["total_raids"]=WebDKP_CharRaidInfo[a9]["total_raids"]+1;tinsert(WebDKP_CharRaidInfo[a9]["attended"],"1&"..previous_raid.."&"..previous_starttime)end;WebDKP_CharRaidInfo[a9]["percent"]=WebDKP_ROUND(WebDKP_CharRaidInfo[a9]["raids_attended"]/WebDKP_CharRaidInfo[a9]["total_raids"]*100,0)end end;WebDKP_UpdateAttendedTable(previous_raid,previous_starttime)end end;function WebDKP_ApplyDateFilter(w)if w==nil or w==""then WebDKP_Print("Please enter an appropiate date to apply the filter. Ex: 11-20-2010")return nil else local X="(%d+)-(%d+)-(%d+)"_,_,month,day,year=string.find(w,X)if month~=nil and day~=nil and year~=nil then return month,day,year else WebDKP_Print("Please enter an appropiate date to apply the filter. Ex: 11-20-2010")return nil end end end;function WebDKP_ProcessCharAttendedRaids(month,day,year,charname)local ad=0;local ae=0;local af=0;month=tonumber(month)day=tonumber(day)year=tonumber(year)local raidsattended=WebDKP_CharRaidInfo[charname]["attended"]local o=getn(raidsattended)for q=1,o,1 do local ag=1;local ah=raidsattended[q]local X="(%d+)&(.+)&(.+)"local _,_,ai,M,aj=string.find(ah,X)local ak="(%d+)-(%d+)-(%d+) (.+)"local _,_,al,am,an=string.find(aj,ak)al=tonumber(al)an=tonumber(an)am=tonumber(am)if al<year then ag=0 end;if al==year and am<month then ag=0 end;if al==year and am==month and an<day then ag=0 end;if ag==1 then ad=ad+1;if ai=="1"then ae=ae+1 end end end;if ad~=0 then af=WebDKP_ROUND(ae/ad*100,0)end;return ad,ae,af end;function WebDKP_CrossCheckDate(c)local ag=1;local w=WebDKP_CharRaidInfoFrameFilterDate:GetText()local month,day,year=WebDKP_ApplyDateFilter(w)month=tonumber(month)day=tonumber(day)year=tonumber(year)local ak="(%d+)-(%d+)-(%d+) (.+)"local _,_,al,am,an=string.find(c,ak)al=tonumber(al)an=tonumber(an)am=tonumber(am)if al<year then ag=0 end;if al==year and am<month then ag=0 end;if al==year and am==month and an<day then ag=0 end;if ag==1 then return true end;return false end