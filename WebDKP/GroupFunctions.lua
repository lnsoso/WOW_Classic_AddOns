function WebDKP_UpdateTable(a)if type(a)=="boolean"and a then table.sort(WebDKP_DkpTableToShow,function(b,c)if b==nil or c==nil then return false end;local d=false;if WebDKP_LogSort["curr"]=="name"then d=b.playerName>c.playerName elseif WebDKP_LogSort["curr"]=="class"then if tostring(b.playerClass)~=tostring(c.playerClass)then d=tostring(b.playerClass)>tostring(c.playerClass)else d=b.playerName>c.playerName end elseif WebDKP_LogSort["curr"]=="dkp"then if tonumber(b.playerDkp)~=tonumber(c.playerDkp)then d=tonumber(b.playerDkp)>tonumber(c.playerDkp)else d=b.playerName>c.playerName end elseif WebDKP_LogSort["curr"]=="zone"then local e,f;if WebDKP_PlayersInGroupStatus[b.playerName]~=nil then e=WebDKP_PlayersInGroupStatus[b.playerName]["zone"]end;if WebDKP_PlayersInGroupStatus[c.playerName]~=nil then f=WebDKP_PlayersInGroupStatus[c.playerName]["zone"]end;if tostring(e)~=tostring(f)then d=tostring(e)>tostring(f)else d=b.playerName>c.playerName end end;if WebDKP_LogSort["way"]==0 then return d else return not d end end)end;local g=getn(WebDKP_DkpTableToShow)FauxScrollFrame_Update(WebDKP_FrameScrollFrame,g,22,20)for h=1,22,1 do local i=getglobal("WebDKP_FrameLine"..h)local j=getglobal("WebDKP_FrameLine"..h.."Name")local k=getglobal("WebDKP_FrameLine"..h.."Class")local l=getglobal("WebDKP_FrameLine"..h.."DKP")local m=getglobal("WebDKP_FrameLine"..h.."Zone")local n=getglobal("WebDKP_FrameLine"..h.."Rank")local o=h+FauxScrollFrame_GetOffset(WebDKP_FrameScrollFrame)if o<=g then local p=WebDKP_DkpTableToShow[o].playerName;local q=WebDKP_DkpTableToShow[o].playerClass;i:Show()j:SetText(WebDKP_DkpTableToShow[o].playerName)k:SetText(q)local r=WebDKP.translations.CLASS_LOCALIZED_TO_ENG_MAP[q]if r~=nil then local s,t,u,v=GetClassColor(string.upper(r))k:SetTextColor(s,t,u)j:SetTextColor(s,t,u)end;l:SetText(WebDKP_DkpTableToShow[o].playerDkp)local w=""if WebDKP_PlayersInGroupStatus[p]~=nil then m:SetText(WebDKP_PlayersInGroupStatus[p]["zone"])if WebDKP_PlayersInGroupStatus[p]["isDead"]then w=w.."(|cffFF0000死亡|r)"end;if not WebDKP_PlayersInGroupStatus[p]["online"]then w=w.."(|cffB5B5B5离线|r)"end else m:SetText("")end;if WebDKP_DkpTable[p]["standby"]==1 then w=w.."(|cff00FE00替补|r)"end;n:SetText(w)if not WebDKP_DkpTable[p]["Selected"]then getglobal("WebDKP_FrameLine"..h.."Background"):SetVertexColor(0,0,0,0)else getglobal("WebDKP_FrameLine"..h.."Background"):SetVertexColor(0.1,0.1,0.9,0.8)end else i:Hide()end end end;function WebDKP_UpdateTableToShow()WebDKP_CleanupTable()tableid=WebDKP_GetTableid()local tableid=WebDKP_GetTableid()local x=0;WebDKP_DkpTableToShow={}for y,z in pairs(WebDKP_DkpTable)do if type(z)=="table"then local p=y;local A=z["class"]local B=WebDKP_GetDKP(p,tableid)local C=floor((B-1)/WebDKP_TierInterval)local D=z["standby"]if B==0 then C=0 end;if WebDKP_ShouldDisplay(p,A,B,C,D)then tinsert(WebDKP_DkpTableToShow,{playerName=p,playerClass=A,playerDkp=B,playerTier=C})else WebDKP_DkpTable[p]["Selected"]=false end end end;for E,F in pairs(WebDKP_PlayersInGroup)do if type(F)=="table"then local p=F["name"]if p~=nil then if WebDKP_DkpTable[p]==nil then local A=F["class"]local B=0;local C=0;WebDKP_MakeSureInTable(p,tableid,A,B)if WebDKP_ShouldDisplay(p,A,B,C)then tinsert(WebDKP_DkpTableToShow,{playerName=p,playerClass=A,playerDkp=B,playerTier=C})else WebDKP_DkpTable[p]["Selected"]=false end end end end end end;function WebDKP_UpdatePlayersInGroup()local G=GetNumGroupMembers()local H=WebDKP_InBattleground()WebDKP_PlayersInGroup={}WebDKP_PlayersInGroupStatus={}if G>0 and H==false then for h=1,G do local I,J,K,L,M,N,O,P,Q,R,S,T=GetRaidRosterInfo(h)WebDKP_PlayersInGroup[h]={["name"]=I,["class"]=M}if I~=nil then WebDKP_PlayersInGroupStatus[I]={["online"]=P,["zone"]=O,["isDead"]=Q}end end else WebDKP_PlayersInGroup[0]={["name"]=UnitName("player"),["class"]=UnitClass("player")}WebDKP_PlayersInGroupStatus[UnitName("player")]={["online"]=true,["zone"]=GetRealZoneText(),["isDead"]=false}end end;function WebDKP_InBattleground()local U,V,W,X,Y;for h=1,10 do U,V,W,X,Y,teamSize=GetBattlefieldStatus(h)if U=="active"then return true end end;return false end;function WebDKP_AllGroupSelected()local I,M;local G=GetNumGroupMembers()local Z=GetNumSubgroupMembers()if G>0 then for h=1,G do I,_,_,_,_,_,_,_,_=GetRaidRosterInfo(h)if not WebDKP_DkpTable[I]["Selected"]then return false end end;return true elseif Z>0 then for h=1,Z do playerHandle="party"..h;I=UnitName(playerHandle)if not WebDKP_DkpTable[I]["Selected"]then return false end end;if not WebDKP_DkpTable[UnitName("player")]["Selected"]then return false end;return true end;return false end;function WebDKP_CleanupTable()for y,z in pairs(WebDKP_DkpTable)do if type(z)=="table"then local p=y;local a0=z["cantrim"]local a1=WebDKP_PlayerInGroup(p)if a0==nil then a0=false end;if a0==false and z["standby"]==0 then local a2=WebDKP_PlayerHasDKP(p)if a2==false then a0=true end end;if z["online"]==true or z["standby"]==1 then a0=false end;if a0==true and a1==false then WebDKP_DkpTable[p]=nil end end end end;function WebDKP_ShouldDisplay(I,M,a3,a4,a5)M=WebDKP.translations.CLASS_LOCALIZED_TO_ENG_MAP[M]if I=="Unknown"then return false end;if WebDKP_Filters[M]==0 then return false end;if WebDKP_PlayersInGroupStatus[I]~=nil then return WebDKP_Filters["Group"]==1 end;if WebDKP_DkpTable[I]~=nil and WebDKP_DkpTable[I]["standby"]==1 then return WebDKP_Filters["Standby1"]==1 end;return WebDKP_Filters["Others"]==1 end;function WebDKP_GetGuildRank(p)local a6="PUG"local a7=50;for a8=1,GetNumGuildMembers(true)do local a9,aa=GetGuildRosterInfo(a8)if a9==p or string.find(a9,p.."-".."(.+)")then a6=aa;return a6 end end;return a6 end