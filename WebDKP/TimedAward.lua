local a;local b;local c;function WebDKP_Award_Encounter_Start(d)a=d;b=time()end;function WebDKP_Award_Encounter_End(d)if d==a then c=time()end end;function WebDKP_BossAward_PerformAward(d,e)if WebDKP_Options["AwardBossDKP"]==1 then local f=select(8,GetInstanceInfo())local g=WebDKP.translations.BOSS_MAP[f]if g~=nil then local h=string.gsub(e,"%s+","")if h==""then h=WebDKP.translations.DB_DUNGEON_ENCOUNTER[d]end;if h==""or h==nil then h=string.format("[%d]unknown name",d)end;if d==a and b~=nil and c~=nil then h=h..string.format("(%ds)",c-b)end;WebDKP_AwardDKP(g,h)end end end;function WebDKP_AwardDKP(g,i)local j=tonumber(WebDKP_Options[g])if j==0 and WebDKP_Options["AwardBossDKPIgnoreZero"]==1 then WebDKP_Print(string.format(WebDKP.translations.AwardBossDKPIgnoreZero_Print,GetRealZoneText(),i))do return end end;for k,l in pairs(WebDKP_WebOptions)do s=SG~=nil and SG==l or next(WebDKP_Tables)==nil;if s then break end end;if not s then return end;WebDKP_ShowAwardFrame(WebDKP.translations.AddDKPReason_BOSS..i,j,"","",function(m,n,o)WebDKP_UpdatePlayersInGroup()WebDKP_AddDKP(m,WebDKP.translations.AddDKPReason_BOSS..i,"false",WebDKP_PlayersInGroup)if WebDKP_Options["AwardBossDKP_Include_Standby"]==1 then local p={}for q,l in pairs(WebDKP_DkpTable)do if l.standby==1 then tinsert(p,{name=q,class=l.class})end end;WebDKP_AddDKP(m,WebDKP.translations.AddDKPReason_BOSS..i,"false",p)end;WebDKP_AnnounceBossAward(m,i)WebDKP_Refresh()end)end;function WebDKP_TimedAward_ToggleUI()if WebDKP_TimedAwardFrame:IsShown()then WebDKP_TimedAwardFrame:Hide()else WebDKP_TimedAwardFrame:Show()local time=WebDKP_TimedAwardFrameTime:GetText()if time==nil or time==""then WebDKP_TimedAwardFrameTime:SetText("5")end;local j=WebDKP_TimedAwardFrameDkp:GetText()if j==nil or j==""then WebDKP_TimedAwardFrameDkp:SetText("0")end end end;function WebDKP_TimedAward_ToggleMiniTimer()if WebDKP_TimedAward_MiniFrame:IsShown()then WebDKP_TimedAward_MiniFrame:Hide()WebDKP_Options["TimedAwardMiniTimer"]=0 else WebDKP_TimedAward_MiniFrame:Show()WebDKP_Options["TimedAwardMiniTimer"]=1 end end;function WebDKP_TimedAward_ShowUI()WebDKP_TimedAwardFrame:Show()local time=WebDKP_TimedAwardFrameTime:GetText()if time==nil or time==""then WebDKP_TimedAwardFrameTime:SetText("0")end;local j=WebDKP_TimedAwardFrameDkp:GetText()if j==nil or j==""then WebDKP_TimedAwardFrameTime:SetText("0")end end;function WebDKP_TimedAward_HideUI()WebDKP_TimedAwardFrame:Hide()end;function WebDKP_TimedAward_ToggleTimer()if WebDKP_Options["TimedAwardInProgress"]==true then WebDKP_Options["TimedAwardInProgress"]=false;WebDKP_TimedAwardFrameStartStopButton:SetText(WebDKP.translations.StartStopButtonText)WebDKP_TimedAward_UpdateFrame:Hide()WebDKP_TimedAward_UpdateText()else WebDKP_Options["TimedAwardInProgress"]=true;if WebDKP_Options["TimedAwardTimer"]==0 then local time=WebDKP_TimedAwardFrameTime:GetText()if time==nil or time==""then time=5 end;WebDKP_Options["TimedAwardTimer"]=time*60 end;WebDKP_TimedAwardFrameStartStopButton:SetText(WebDKP.translations.StartStopButtonText2)WebDKP_TimedAward_UpdateFrame:Show()WebDKP_TimedAward_UpdateText()end end;function WebDKP_TimedAward_ResetTimer()local time=WebDKP_TimedAwardFrameTime:GetText()if time==nil or time==""then time=5 end;WebDKP_Options["TimedAwardTimer"]=time*60;WebDKP_TimedAward_UpdateText()end;function WebDKP_TimedAward_OnUpdate(self,r)local t=self;t.TimeSinceLastUpdate=t.TimeSinceLastUpdate+r;if t.TimeSinceLastUpdate>1.0 then t.TimeSinceLastUpdate=0;WebDKP_Options["TimedAwardTimer"]=WebDKP_Options["TimedAwardTimer"]-1;WebDKP_TimedAward_UpdateText()if WebDKP_Options["TimedAwardTimer"]<=0 then WebDKP_TimedAward_PerformAward()if WebDKP_Options["TimedAwardRepeat"]==1 then WebDKP_TimedAward_ResetTimer()else WebDKP_Options["TimedAwardInProgress"]=false;WebDKP_TimedAwardFrameStartStopButton:SetText(WebDKP.translations.StartStopButtonText)WebDKP_TimedAward_UpdateFrame:Hide()end end end end;function WebDKP_TimedAward_UpdateText()local u=""local v=floor(WebDKP_Options["TimedAwardTimer"]/60)local w=WebDKP_Options["TimedAwardTimer"]%60;if v>0 then u=u..v..":"end;if w<10 then w="0"..w end;u=u..w;WebDKP_TimedAwardFrameTimeLeft:SetText(WebDKP.translations.TimeFlag..u)WebDKP_TimedAward_MiniFrameTimeLeft:SetText(u)end;function WebDKP_TimedAward_PerformAward()WebDKP_UpdatePlayersInGroup()local x=WebDKP_PlayersInGroup;local y=WebDKP_GetTableSize(WebDKP_PlayersInGroup)local j=WebDKP_TimedAwardFrameDkp:GetText()if j==nil or j==""then j=0 end;j=tonumber(j)if WebDKP_Options["TimedStandby"]==1 then for z,l in pairs(WebDKP_DkpTable)do if type(l)=="table"then local A=z;local B=l["class"]local C=l["standby"]if C~=nil and C==1 then y=y+1;x[y]={["name"]=A,["class"]=B}end end end end;WebDKP_AddDKP(j,WebDKP.translations.ReasonTimedAward,"false",WebDKP_PlayersInGroup)WebDKP_UpdateTableToShow()WebDKP_UpdateTable()WebDKP_AnnounceTimedAward(WebDKP_TimedAwardFrameTime:GetText(),j)WebDKP_Refresh()end